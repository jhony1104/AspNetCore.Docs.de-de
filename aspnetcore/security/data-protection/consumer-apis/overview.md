---
title: Übersicht über Consumer-APIs für ASP.net Core
author: rick-anderson
description: Erhalten Sie einen kurzen Überblick über die verschiedenen Consumer-APIs, die in der ASP.net Core Datenschutz Bibliothek verfügbar sind.
ms.author: riande
ms.date: 06/11/2019
no-loc:
- Blazor
- Blazor Server
- Blazor WebAssembly
- Identity
- Let's Encrypt
- Razor
- SignalR
uid: security/data-protection/consumer-apis/overview
ms.openlocfilehash: 0bb163b677062c46a077731c014a40c602764594
ms.sourcegitcommit: d65a027e78bf0b83727f975235a18863e685d902
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 06/26/2020
ms.locfileid: "85406718"
---
# <a name="consumer-apis-overview-for-aspnet-core"></a><span data-ttu-id="56c73-103">Übersicht über Consumer-APIs für ASP.net Core</span><span class="sxs-lookup"><span data-stu-id="56c73-103">Consumer APIs overview for ASP.NET Core</span></span>

<span data-ttu-id="56c73-104">Die `IDataProtectionProvider` -Schnittstelle und die- `IDataProtector` Schnittstelle sind die Basis Schnittstellen, über die Consumer das Datenschutzsystem verwenden.</span><span class="sxs-lookup"><span data-stu-id="56c73-104">The `IDataProtectionProvider` and `IDataProtector` interfaces are the basic interfaces through which consumers use the data protection system.</span></span> <span data-ttu-id="56c73-105">Sie befinden sich im Paket [Microsoft. aspnetcore. dataprotection. Abstractions](https://www.nuget.org/packages/Microsoft.AspNetCore.DataProtection.Abstractions/) .</span><span class="sxs-lookup"><span data-stu-id="56c73-105">They're located in the [Microsoft.AspNetCore.DataProtection.Abstractions](https://www.nuget.org/packages/Microsoft.AspNetCore.DataProtection.Abstractions/) package.</span></span>

## <a name="idataprotectionprovider"></a><span data-ttu-id="56c73-106">Idataschutzprovider</span><span class="sxs-lookup"><span data-stu-id="56c73-106">IDataProtectionProvider</span></span>

<span data-ttu-id="56c73-107">Die Anbieter Schnittstelle stellt den Stamm des Datenschutzsystems dar.</span><span class="sxs-lookup"><span data-stu-id="56c73-107">The provider interface represents the root of the data protection system.</span></span> <span data-ttu-id="56c73-108">Sie kann nicht direkt verwendet werden, um Daten zu schützen oder deren Schutz aufzuheben.</span><span class="sxs-lookup"><span data-stu-id="56c73-108">It cannot directly be used to protect or unprotect data.</span></span> <span data-ttu-id="56c73-109">Stattdessen muss der Consumer einen Verweis auf einen `IDataProtector` abrufen, indem er aufgerufen `IDataProtectionProvider.CreateProtector(purpose)` wird, wobei Zweck eine Zeichenfolge ist, die den vorgesehenen consumerfallfall beschreibt.</span><span class="sxs-lookup"><span data-stu-id="56c73-109">Instead, the consumer must get a reference to an `IDataProtector` by calling `IDataProtectionProvider.CreateProtector(purpose)`, where purpose is a string that describes the intended consumer use case.</span></span> <span data-ttu-id="56c73-110">Weitere Informationen zum Zweck dieses Parameters und zum Auswählen eines geeigneten Werts finden Sie unter [Zweck](xref:security/data-protection/consumer-apis/purpose-strings) Zeichenfolgen.</span><span class="sxs-lookup"><span data-stu-id="56c73-110">See [Purpose Strings](xref:security/data-protection/consumer-apis/purpose-strings) for much more information on the intent of this parameter and how to choose an appropriate value.</span></span>

## <a name="idataprotector"></a><span data-ttu-id="56c73-111">Idataprotector</span><span class="sxs-lookup"><span data-stu-id="56c73-111">IDataProtector</span></span>

<span data-ttu-id="56c73-112">Die Schutzvorrichtung wird durch einen-Rückruf zurückgegeben `CreateProtector` , und es handelt sich um diese Schnittstelle, mit der Consumer Vorgänge zum Schutz und zum Aufheben des Schutzes durchführen können.</span><span class="sxs-lookup"><span data-stu-id="56c73-112">The protector interface is returned by a call to `CreateProtector`, and it's this interface which consumers can use to perform protect and unprotect operations.</span></span>

<span data-ttu-id="56c73-113">Um ein Datenelement zu schützen, übergeben Sie die Daten an die- `Protect` Methode.</span><span class="sxs-lookup"><span data-stu-id="56c73-113">To protect a piece of data, pass the data to the `Protect` method.</span></span> <span data-ttu-id="56c73-114">Die grundlegende Schnittstelle definiert eine Methode, die Byte []-> Byte [] konvertiert, aber es gibt auch eine Überladung (als Erweiterungsmethode bereitgestellt), die Zeichen folgen > Zeichenfolge konvertiert.</span><span class="sxs-lookup"><span data-stu-id="56c73-114">The basic interface defines a method which converts byte[] -> byte[], but there's also an overload (provided as an extension method) which converts string -> string.</span></span> <span data-ttu-id="56c73-115">Die von den beiden Methoden angebotene Sicherheit ist identisch. der Entwickler sollte auswählen, welche Überladung für den Anwendungsfall am bequemsten ist.</span><span class="sxs-lookup"><span data-stu-id="56c73-115">The security offered by the two methods is identical; the developer should choose whichever overload is most convenient for their use case.</span></span> <span data-ttu-id="56c73-116">Unabhängig von der gewählten Überladung wird der von der Protect-Methode zurückgegebene Wert nun geschützt (verschlüsselt und manipuliert), und die Anwendung kann Sie an einen nicht vertrauenswürdigen Client senden.</span><span class="sxs-lookup"><span data-stu-id="56c73-116">Irrespective of the overload chosen, the value returned by the Protect method is now protected (enciphered and tamper-proofed), and the application can send it to an untrusted client.</span></span>

<span data-ttu-id="56c73-117">Um den Schutz für ein zuvor geschütztes Datenelement aufzuheben, übergeben Sie die geschützten Daten an die- `Unprotect` Methode.</span><span class="sxs-lookup"><span data-stu-id="56c73-117">To unprotect a previously-protected piece of data, pass the protected data to the `Unprotect` method.</span></span> <span data-ttu-id="56c73-118">(Es gibt Byte []-basierte und Zeichen folgen basierte über Ladungen für Entwickler.) Wenn die geschützte Nutzlast von einem früheren-Befehl in generiert wurde `Protect` `IDataProtector` , gibt die- `Unprotect` Methode die ursprüngliche ungeschützte Nutzlast zurück.</span><span class="sxs-lookup"><span data-stu-id="56c73-118">(There are byte[]-based and string-based overloads for developer convenience.) If the protected payload was generated by an earlier call to `Protect` on this same `IDataProtector`, the `Unprotect` method will return the original unprotected payload.</span></span> <span data-ttu-id="56c73-119">Wenn die geschützte Nutzlast manipuliert wurde oder von einer anderen erstellt wurde `IDataProtector` , löst die `Unprotect` Methode CryptographicException aus.</span><span class="sxs-lookup"><span data-stu-id="56c73-119">If the protected payload has been tampered with or was produced by a different `IDataProtector`, the `Unprotect` method will throw CryptographicException.</span></span>

<span data-ttu-id="56c73-120">Das Konzept der gleichen und unterschiedlichen Verknüpfungen `IDataProtector` zurück zum Konzept des zwecks.</span><span class="sxs-lookup"><span data-stu-id="56c73-120">The concept of same vs. different `IDataProtector` ties back to the concept of purpose.</span></span> <span data-ttu-id="56c73-121">Wenn zwei `IDataProtector` Instanzen aus demselben Stamm generiert wurden `IDataProtectionProvider` , aber über unterschiedliche Zweck Zeichenfolgen im Aufruf von `IDataProtectionProvider.CreateProtector` , werden Sie als [unterschiedliche Schutz](xref:security/data-protection/consumer-apis/purpose-strings)Vorrichtungen angesehen, und eine kann nicht den Schutz von Nutzlasten aufheben, die von der anderen generiert werden.</span><span class="sxs-lookup"><span data-stu-id="56c73-121">If two `IDataProtector` instances were generated from the same root `IDataProtectionProvider` but via different purpose strings in the call to `IDataProtectionProvider.CreateProtector`, then they're considered [different protectors](xref:security/data-protection/consumer-apis/purpose-strings), and one won't be able to unprotect payloads generated by the other.</span></span>

## <a name="consuming-these-interfaces"></a><span data-ttu-id="56c73-122">Verwenden dieser Schnittstellen</span><span class="sxs-lookup"><span data-stu-id="56c73-122">Consuming these interfaces</span></span>

<span data-ttu-id="56c73-123">Bei einer di-fähigen Komponente besteht die beabsichtigte Verwendung darin, dass die Komponente einen `IDataProtectionProvider` -Parameter im Konstruktor annimmt und dass das di-System diesen Dienst automatisch bereitstellt, wenn die Komponente instanziiert wird.</span><span class="sxs-lookup"><span data-stu-id="56c73-123">For a DI-aware component, the intended usage is that the component takes an `IDataProtectionProvider` parameter in its constructor and that the DI system automatically provides this service when the component is instantiated.</span></span>

> [!NOTE]
> <span data-ttu-id="56c73-124">Einige Anwendungen (z. b. Konsolen Anwendungen oder ASP.NET 4. x-Anwendungen) sind möglicherweise nicht di-fähig und können den hier beschriebenen Mechanismus nicht verwenden.</span><span class="sxs-lookup"><span data-stu-id="56c73-124">Some applications (such as console applications or ASP.NET 4.x applications) might not be DI-aware so cannot use the mechanism described here.</span></span> <span data-ttu-id="56c73-125">Informationen zu diesen Szenarien finden Sie in den Dokumenten zu nicht-di-fähigen [Szenarios](xref:security/data-protection/configuration/non-di-scenarios) , um weitere Informationen zum Abrufen einer Instanz eines Anbieters ohne Verwendung von di zu erhalten `IDataProtection` .</span><span class="sxs-lookup"><span data-stu-id="56c73-125">For these scenarios consult the [Non DI Aware Scenarios](xref:security/data-protection/configuration/non-di-scenarios) document for more information on getting an instance of an `IDataProtection` provider without going through DI.</span></span>

<span data-ttu-id="56c73-126">Im folgenden Beispiel werden drei Konzepte veranschaulicht:</span><span class="sxs-lookup"><span data-stu-id="56c73-126">The following sample demonstrates three concepts:</span></span>

1. <span data-ttu-id="56c73-127">[Hinzufügen des Datenschutzsystems](xref:security/data-protection/configuration/overview) zum Dienst Container</span><span class="sxs-lookup"><span data-stu-id="56c73-127">[Add the data protection system](xref:security/data-protection/configuration/overview) to the service container,</span></span>

2. <span data-ttu-id="56c73-128">Verwenden von di zum Empfangen einer Instanz von `IDataProtectionProvider` und</span><span class="sxs-lookup"><span data-stu-id="56c73-128">Using DI to receive an instance of an `IDataProtectionProvider`, and</span></span>

3. <span data-ttu-id="56c73-129">Erstellen eines `IDataProtector` aus einem `IDataProtectionProvider` und verwenden dieses zum schützen und Aufheben des Schutzes von Daten.</span><span class="sxs-lookup"><span data-stu-id="56c73-129">Creating an `IDataProtector` from an `IDataProtectionProvider` and using it to protect and unprotect data.</span></span>

[!code-csharp[](../using-data-protection/samples/protectunprotect.cs?highlight=26,34,35,36,37,38,39,40)]

<span data-ttu-id="56c73-130">Das Paket Microsoft. aspnetcore. dataprotection. Abstractions enthält eine Erweiterungsmethode, die `IServiceProvider.GetDataProtector` für den Entwickler von Vorteil ist.</span><span class="sxs-lookup"><span data-stu-id="56c73-130">The package Microsoft.AspNetCore.DataProtection.Abstractions contains an extension method `IServiceProvider.GetDataProtector` as a developer convenience.</span></span> <span data-ttu-id="56c73-131">Sie wird als einzelner Vorgang gekapselt, wobei sowohl ein `IDataProtectionProvider` vom Dienstanbieter abgerufen als auch aufgerufen wird `IDataProtectionProvider.CreateProtector` .</span><span class="sxs-lookup"><span data-stu-id="56c73-131">It encapsulates as a single operation both retrieving an `IDataProtectionProvider` from the service provider and calling `IDataProtectionProvider.CreateProtector`.</span></span> <span data-ttu-id="56c73-132">Im folgenden Beispiel wird die Verwendung veranschaulicht.</span><span class="sxs-lookup"><span data-stu-id="56c73-132">The following sample demonstrates its usage.</span></span>

[!code-csharp[](./overview/samples/getdataprotector.cs?highlight=15)]

>[!TIP]
> <span data-ttu-id="56c73-133">Instanzen von `IDataProtectionProvider` und `IDataProtector` sind für mehrere Aufrufer Thread sicher.</span><span class="sxs-lookup"><span data-stu-id="56c73-133">Instances of `IDataProtectionProvider` and `IDataProtector` are thread-safe for multiple callers.</span></span> <span data-ttu-id="56c73-134">Wenn eine Komponente einen Verweis auf einen `IDataProtector` über einen Aufruf von erhält `CreateProtector` , wird dieser Verweis für mehrere Aufrufe von `Protect` und verwendet `Unprotect` .</span><span class="sxs-lookup"><span data-stu-id="56c73-134">It's intended that once a component gets a reference to an `IDataProtector` via a call to `CreateProtector`, it will use that reference for multiple calls to `Protect` and `Unprotect`.</span></span> <span data-ttu-id="56c73-135">Ein-Aufrufe von löst `Unprotect` CryptographicException aus, wenn die geschützte Nutzlast nicht überprüft oder nicht verschlüsselt werden kann.</span><span class="sxs-lookup"><span data-stu-id="56c73-135">A call to `Unprotect` will throw CryptographicException if the protected payload cannot be verified or deciphered.</span></span> <span data-ttu-id="56c73-136">Einige Komponenten möchten möglicherweise Fehler beim Vorgang zum Aufheben des Schutzes ignorieren. eine Komponente, die Authentifizierungs Cookies liest, kann diesen Fehler behandeln und die Anforderung so behandeln, als ob Sie überhaupt kein Cookie hätte, anstatt die Anforderung vollständig zu übernehmen.</span><span class="sxs-lookup"><span data-stu-id="56c73-136">Some components may wish to ignore errors during unprotect operations; a component which reads authentication cookies might handle this error and treat the request as if it had no cookie at all rather than fail the request outright.</span></span> <span data-ttu-id="56c73-137">Komponenten, für die dieses Verhalten gewünscht ist, sollten CryptographicException genau abfangen, anstatt alle Ausnahmen zu verschlucken.</span><span class="sxs-lookup"><span data-stu-id="56c73-137">Components which want this behavior should specifically catch CryptographicException instead of swallowing all exceptions.</span></span>
